<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Cinema Palace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 1.5rem;
        }
        .card-header {
            background-color: #495057;
            color: white;
            font-weight: bold;
        }
        .table th {
            background-color: #6c757d;
            color: white;
        }
        .btn-add {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
        }
        .btn-add:hover {
            background: linear-gradient(45deg, #218838, #1aa179);
            color: white;
        }

        .seats-admin-grid {
            display: inline-block;
            border: 2px solid #dee2e6;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8f9fa;
        }
        
        .seats-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .row-label {
            width: 30px;
            text-align: center;
            font-weight: bold;
            margin-right: 10px;
            color: #495057;
        }
        
        .seat-admin {
            width: 35px;
            height: 35px;
            margin: 2px;
            border: 2px solid #6c757d;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .seat-admin:hover {
            border-width: 3px;
        }
        
        .seat-admin.normal {
            background-color: #6c757d;
            color: white;
        }
        
        .seat-admin.pmr {
            background-color: #ffc107;
            color: #000;
        }
        
        .seat-admin.stair {
            background-color: #17a2b8;
            color: white;
        }
        
        .seat-admin.empty {
            background-color: transparent;
            border-style: dashed;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="mb-0">üé¨ Administration Cinema Palace</h1>
                    <p class="mb-0">Gestion des films, salles et s√©ances</p>
                </div>
                <div class="col-auto">
                    <a href="/" class="btn btn-outline-light">
                        <i class="fas fa-home"></i> Retour √† l'accueil
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Messages Flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="row">
            <!-- Gestion des Films -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üé≠ Gestion des Films</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/admin/movie" class="mb-3">
                            <div class="row g-2 mb-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" name="name" placeholder="Nom du film" required>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" name="duration" placeholder="Dur√©e (min)" required>
                                </div>
                            </div>
                            <div class="row g-2 mb-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" name="director" placeholder="R√©alisateur">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" name="cast" placeholder="Acteurs principaux">
                                </div>
                            </div>
                            <div class="row g-2 mb-2">
                                <div class="col-md-10">
                                    <textarea class="form-control" name="synopsis" placeholder="Synopsis" rows="2"></textarea>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-add w-100 h-100">Ajouter</button>
                                </div>
                            </div>
                        </form>
                        
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nom</th>
                                        <th>Dur√©e</th>
                                        <th>R√©alisateur</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if movies %}
                                        {% for movie in movies %}
                                        <tr>
                                            <td>{{ movie.id }}</td>
                                            <td>{{ movie.name }}</td>
                                            <td>{{ movie.duration }} min</td>
                                            <td>{{ movie.director or '-' }}</td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-warning me-1" data-bs-toggle="modal" data-bs-target="#editMovieModal{{ movie.id }}">‚úèÔ∏è</button>
                                                <form method="POST" action="/admin/movie/{{ movie.id }}/delete" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer ce film ?')">üóëÔ∏è</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="5" class="text-center text-muted">Aucun film</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gestion des Salles -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üèõÔ∏è Gestion des Salles</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/admin/room" class="mb-3">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" name="name" placeholder="Nom de la salle" required>
                                </div>
                                <div class="col-md-3">
                                    <input type="number" class="form-control" name="rows" placeholder="Rang√©es" min="1" max="20" required>
                                </div>
                                <div class="col-md-3">
                                    <input type="number" class="form-control" name="columns" placeholder="Colonnes" min="1" max="20" required>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-add w-100">+</button>
                                </div>
                            </div>
                        </form>
                        
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nom</th>
                                        <th>Rang√©es</th>
                                        <th>Colonnes</th>
                                        <th>Total</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if rooms %}
                                        {% for room in rooms %}
                                        <tr>
                                            <td>{{ room.id }}</td>
                                            <td>{{ room.name }}</td>
                                            <td>{{ room.nb_rows }}</td>
                                            <td>{{ room.nb_columns }}</td>
                                            <td>{{ room.nb_rows * room.nb_columns }}</td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-warning me-1" data-bs-toggle="modal" data-bs-target="#editRoomModal{{ room.id }}">‚úèÔ∏è</button>
                                                <form method="POST" action="/admin/room/{{ room.id }}/delete" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette salle ?')">üóëÔ∏è</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">Aucune salle</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des S√©ances -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üéûÔ∏è Gestion des S√©ances</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/admin/showing" class="mb-4">
                            <div class="row g-3">
                                <div class="col-md-2">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" name="date" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Heure</label>
                                    <input type="time" class="form-control" name="starttime" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Prix (‚Ç¨)</label>
                                    <input type="number" step="0.01" class="form-control" name="baseprice" placeholder="12.50" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Salle</label>
                                    <select class="form-select" name="room_id" required>
                                        <option value="">Choisir...</option>
                                        {% if rooms %}
                                            {% for room in rooms %}
                                            <option value="{{ room.id }}">{{ room.name }}</option>
                                            {% endfor %}
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Film</label>
                                    <select class="form-select" name="movie_id" required>
                                        <option value="">Choisir...</option>
                                        {% if movies %}
                                            {% for movie in movies %}
                                            <option value="{{ movie.id }}">{{ movie.name }}</option>
                                            {% endfor %}
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="col-md-1">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="submit" class="btn btn-add w-100">Ajouter</button>
                                </div>
                            </div>
                        </form>
                        
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Date</th>
                                        <th>Heure</th>
                                        <th>Film</th>
                                        <th>Salle</th>
                                        <th>Prix</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if showings %}
                                        {% for showing in showings %}
                                        <tr>
                                            <td>{{ showing.id }}</td>
                                            <td>{{ showing.date.strftime('%d/%m/%Y') if showing.date else '' }}</td>
                                            <td>{{ showing.starttime }}</td>
                                            <td>{{ showing.movie_name }}</td>
                                            <td>{{ showing.room_name }}</td>
                                            <td>{{ "%.2f"|format(showing.baseprice / 100) }}‚Ç¨</td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-warning me-1" data-bs-toggle="modal" data-bs-target="#editShowingModal{{ showing.id }}">‚úèÔ∏è</button>
                                                <form method="POST" action="/admin/showing/{{ showing.id }}/delete" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette s√©ance ?')">üóëÔ∏è</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="7" class="text-center text-muted">Aucune s√©ance</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des R√©servations -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üé´ Gestion des R√©servations</h5>
                        <span class="badge bg-primary">
                            {% if bookings %}{{ bookings|length }}{% else %}0{% endif %} r√©servation(s)
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Utilisateur</th>
                                        <th>Film</th>
                                        <th>S√©ance</th>
                                        <th>Places</th>
                                        <th>Prix</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if bookings %}
                                        {% for booking in bookings %}
                                        <tr>
                                            <td><strong>#{{ booking.booking_id }}</strong></td>
                                            <td>
                                                <div class="fw-bold">{{ booking.username }}</div>
                                                <small class="text-muted">{{ booking.email }}</small>
                                            </td>
                                            <td>{{ booking.movie_name }}</td>
                                            <td>
                                                <div>{{ booking.date.strftime('%d/%m/%Y') }}</div>
                                                <small class="text-muted">{{ booking.time }} - {{ booking.room_name }}</small>
                                            </td>
                                            <td>
                                                <span class="badge bg-info">{{ booking.seat_count }} place(s)</span>
                                                <div class="mt-1">
                                                    {% for seat in booking.seats_list %}
                                                        <span class="badge bg-light text-dark me-1">{{ seat }}</span>
                                                    {% endfor %}
                                                </div>
                                            </td>
                                            <td>
                                                <strong class="text-success">{{ "%.2f"|format(booking.price_euros) }}‚Ç¨</strong>
                                            </td>
                                            <td>
                                                <form method="POST" action="/admin/booking/{{ booking.booking_id }}/cancel" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-danger" 
                                                            onclick="return confirm('√ätes-vous s√ªr de vouloir annuler cette r√©servation ? Cette action est irr√©versible.')">
                                                        üóëÔ∏è Annuler
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="7" class="text-center text-muted">Aucune r√©servation</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                        
                        {% if bookings %}
                        <div class="mt-3">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-primary">{{ bookings|length }}</div>
                                        <small class="text-muted">R√©servations totales</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-success">{{ bookings|sum(attribute='seat_count') }}</div>
                                        <small class="text-muted">Places r√©serv√©es</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-info">{{ "%.0f"|format(bookings|sum(attribute='price_euros')) }}‚Ç¨</div>
                                        <small class="text-muted">Chiffre d'affaires</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-warning">
                                            {% set today_bookings = bookings|selectattr('date', 'eq', today)|list %}
                                            {{ today_bookings|length if today_bookings else 0 }}
                                        </div>
                                        <small class="text-muted">R√©servations aujourd'hui</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des Si√®ges -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ü™ë Gestion des Si√®ges</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="room-select" class="form-label">S√©lectionner une salle :</label>
                                <select id="room-select" class="form-select">
                                    <option value="">Aucune s√©lection</option>
                                    {% if rooms %}
                                        {% for room in rooms %}
                                        <option value="{{ room.id }}" data-rows="{{ room.nb_rows }}" data-columns="{{ room.nb_columns }}">
                                            {{ room.name }} ({{ room.nb_rows }}x{{ room.nb_columns }})
                                        </option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                        </div>
                        
                        <div id="seats-grid-container" style="display: none;">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 id="selected-room-title" class="mb-0"></h6>
                                <div class="d-flex gap-3">
                                    <span><span class="badge bg-secondary">Normal</span></span>
                                    <span><span class="badge bg-warning text-dark">PMR</span></span>
                                    <span><span class="badge bg-info">Escalier</span></span>
                                    <span><span class="badge bg-light text-dark border">Vide</span></span>
                                </div>
                            </div>
                            
                            <div class="text-center mb-3">
                                <div class="bg-dark text-white py-2 px-4 rounded">√âCRAN</div>
                            </div>
                            
                            <div id="seats-grid" class="seats-admin-grid">
                                <!-- La grille sera g√©n√©r√©e dynamiquement -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const roomSelect = document.getElementById('room-select');
            const seatsGridContainer = document.getElementById('seats-grid-container');
            const selectedRoomTitle = document.getElementById('selected-room-title');
            const seatsGrid = document.getElementById('seats-grid');
            
            roomSelect.addEventListener('change', function() {
                const roomId = this.value;
                if (!roomId) {
                    seatsGridContainer.style.display = 'none';
                    return;
                }
                
                const selectedOption = this.options[this.selectedIndex];
                const roomName = selectedOption.text;
                selectedRoomTitle.textContent = `Configuration des si√®ges - ${roomName}`;
                
                loadRoomSeats(roomId);
            });
            
            async function loadRoomSeats(roomId) {
                try {
                    const response = await fetch(`/api/room/${roomId}/seats`);
                    const data = await response.json();
                    
                    if (data.error) {
                        alert('Erreur: ' + data.error);
                        return;
                    }
                    
                    generateSeatsGrid(data);
                    seatsGridContainer.style.display = 'block';
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('Erreur lors du chargement des si√®ges');
                }
            }
            
            function generateSeatsGrid(data) {
                console.log('Donn√©es des si√®ges:', data);
                const { room, grid } = data;
                seatsGrid.innerHTML = '';
                
                // G√©n√©rer les rang√©es (A, B, C, ...)
                for (let rowIndex = 1; rowIndex <= room.nb_rows; rowIndex++) {
                    const rowLetter = String.fromCharCode(64 + rowIndex);
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'seats-row';
                    
                    // Label de la rang√©e
                    const rowLabel = document.createElement('div');
                    rowLabel.className = 'row-label';
                    rowLabel.textContent = rowLetter;
                    rowDiv.appendChild(rowLabel);
                    
                    // Si√®ges de la rang√©e
                    for (let colIndex = 1; colIndex <= room.nb_columns; colIndex++) {
                        const seatDiv = document.createElement('div');
                        seatDiv.className = 'seat-admin';
                        seatDiv.textContent = colIndex;
                        
                        // R√©cup√©rer les donn√©es du si√®ge
                        const seatData = grid[rowLetter] && grid[rowLetter][colIndex];
                        if (seatData) {
                            seatDiv.classList.add(seatData.type);
                            seatDiv.dataset.seatId = seatData.id;
                            seatDiv.dataset.currentType = seatData.type;
                            
                            // Gestionnaire de clic pour changer le type
                            seatDiv.addEventListener('click', function() {
                                changeSeatType(this);
                            });
                        }
                        
                        rowDiv.appendChild(seatDiv);
                    }
                    
                    seatsGrid.appendChild(rowDiv);
                }
            }
            
            function changeSeatType(seatElement) {
                const currentType = seatElement.dataset.currentType;
                const types = ['normal', 'pmr', 'stair', 'empty'];
                const currentIndex = types.indexOf(currentType);
                const nextIndex = (currentIndex + 1) % types.length;
                const newType = types[nextIndex];
                
                updateSeatType(seatElement.dataset.seatId, newType, seatElement);
            }
            
            async function updateSeatType(seatId, newType, seatElement) {
                try {
                    const response = await fetch(`/api/seat/${seatId}/type`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ type: newType })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Mettre √† jour l'apparence du si√®ge
                        seatElement.className = `seat-admin ${newType}`;
                        seatElement.dataset.currentType = newType;
                    } else {
                        alert('Erreur: ' + result.message);
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('Erreur lors de la mise √† jour');
                }
            }
        });
    </script>

    <!-- Modales de modification -->
    
    <!-- Modales pour les films -->
    {% if movies %}
        {% for movie in movies %}
        <div class="modal fade" id="editMovieModal{{ movie.id }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modifier le film: {{ movie.name }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="POST" action="/admin/movie/{{ movie.id }}/update">
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Nom</label>
                                <input type="text" class="form-control" name="name" value="{{ movie.name }}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Dur√©e (minutes)</label>
                                <input type="number" class="form-control" name="duration" value="{{ movie.duration }}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">R√©alisateur</label>
                                <input type="text" class="form-control" name="director" value="{{ movie.director or '' }}">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Acteurs principaux</label>
                                <input type="text" class="form-control" name="cast" value="{{ movie.cast or '' }}">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Synopsis</label>
                                <textarea class="form-control" name="synopsis" rows="3">{{ movie.synopsis or '' }}</textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}

    <!-- Modales pour les salles -->
    {% if rooms %}
        {% for room in rooms %}
        <div class="modal fade" id="editRoomModal{{ room.id }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modifier la salle: {{ room.name }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="POST" action="/admin/room/{{ room.id }}/update">
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Nom</label>
                                <input type="text" class="form-control" name="name" value="{{ room.name }}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nombre de rang√©es</label>
                                <input type="number" class="form-control" name="rows" value="{{ room.nb_rows }}" min="1" max="26" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nombre de colonnes</label>
                                <input type="number" class="form-control" name="columns" value="{{ room.nb_columns }}" min="1" max="50" required>
                            </div>
                            <div class="alert alert-warning">
                                <small><strong>Attention:</strong> Modifier les dimensions (rang√©es/colonnes) supprimera tous les si√®ges existants et les recr√©era. Cette op√©ration n'est possible que si la salle n'est utilis√©e dans aucune s√©ance.</small>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}

    <!-- Modales pour les s√©ances -->
    {% if showings %}
        {% for showing in showings %}
        <div class="modal fade" id="editShowingModal{{ showing.id }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modifier la s√©ance: {{ showing.movie_name }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="POST" action="/admin/showing/{{ showing.id }}/update">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" name="date" value="{{ showing.date.strftime('%Y-%m-%d') if showing.date else '' }}" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Heure</label>
                                        <input type="time" class="form-control" name="starttime" value="{{ showing.starttime }}" required>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Prix (‚Ç¨)</label>
                                <input type="number" step="0.01" class="form-control" name="baseprice" value="{{ "%.2f"|format(showing.baseprice / 100) }}" required>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Salle</label>
                                        <select class="form-select" name="room_id" required>
                                            {% if rooms %}
                                                {% for room in rooms %}
                                                <option value="{{ room.id }}" {% if room.id == showing.room_id %}selected{% endif %}>{{ room.name }}</option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Film</label>
                                        <select class="form-select" name="movie_id" required>
                                            {% if movies %}
                                                {% for movie in movies %}
                                                <option value="{{ movie.id }}" {% if movie.id == showing.movie_id %}selected{% endif %}>{{ movie.name }}</option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}

</body>
</html>
